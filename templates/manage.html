{% extends "base.html" %}

{% block title %}Manage Feeds - TBMCG News Dashboard{% endblock %}

{% block content %}
<div class="manage-container">
    <!-- Header -->
    <div class="manage-header">
        <div class="header-info">
            <h1>Feed Manager</h1>
            <p>Manage RSS feeds and categories for the organization</p>
        </div>
        <div class="header-actions">
            <button class="btn btn-outline" onclick="exportFeeds()">
                <span class="material-icons">download</span>
                Export
            </button>
            <button class="btn btn-outline" onclick="document.getElementById('importFile').click()">
                <span class="material-icons">upload</span>
                Import
            </button>
            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importFeeds(event)">
            <button class="btn btn-primary" onclick="showAddCategoryModal()">
                <span class="material-icons">create_new_folder</span>
                Add Category
            </button>
            <button class="btn btn-primary" onclick="showAddFeedModal()">
                <span class="material-icons">add</span>
                Add Feed
            </button>
        </div>
    </div>

    <!-- Categories -->
    <div class="categories-container" id="categoriesContainer">
        <!-- Categories will be populated by JavaScript -->
    </div>
</div>

<!-- Add/Edit Category Modal -->
<div class="modal" id="categoryModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="categoryModalTitle">Add Category</h2>
            <button class="modal-close" onclick="closeCategoryModal()">
                <span class="material-icons">close</span>
            </button>
        </div>
        <div class="modal-body">
            <form id="categoryForm">
                <input type="hidden" id="categoryId">
                <div class="form-group">
                    <label for="categoryName">Category Name</label>
                    <input type="text" id="categoryName" name="name" required>
                </div>
                <div class="form-group">
                    <label for="categoryColor">Category Color</label>
                    <div class="color-picker-container">
                        <div class="color-preview" id="colorPreview" title="Click to open custom color picker"></div>
                        <div class="color-swatches">
                            <div class="color-swatch selected" data-color="#6366f1" style="background-color: #6366f1;" title="Primary Blue"></div>
                            <div class="color-swatch" data-color="#0ea5e9" style="background-color: #0ea5e9;" title="Cyan"></div>
                            <div class="color-swatch" data-color="#10b981" style="background-color: #10b981;" title="Green"></div>
                            <div class="color-swatch" data-color="#f59e0b" style="background-color: #f59e0b;" title="Orange"></div>
                            <div class="color-swatch" data-color="#8b5cf6" style="background-color: #8b5cf6;" title="Purple"></div>
                            <div class="color-swatch" data-color="#ef4444" style="background-color: #ef4444;" title="Red"></div>
                            <div class="color-swatch" data-color="#3b82f6" style="background-color: #3b82f6;" title="Blue"></div>
                            <div class="color-swatch" data-color="#06b6d4" style="background-color: #06b6d4;" title="Teal"></div>
                            <div class="color-swatch" data-color="#84cc16" style="background-color: #84cc16;" title="Lime"></div>
                            <div class="color-swatch" data-color="#f97316" style="background-color: #f97316;" title="Orange Red"></div>
                            <div class="color-swatch" data-color="#ec4899" style="background-color: #ec4899;" title="Pink"></div>
                            <div class="color-swatch" data-color="#6b7280" style="background-color: #6b7280;" title="Gray"></div>
                        </div>
                        <div class="custom-color-input">
                            <input type="color" id="categoryColor" name="color" value="#6366f1" style="display: none;">
                            <span class="custom-color-label">Custom Color</span>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline" onclick="closeCategoryModal()">Cancel</button>
            <button class="btn btn-primary" onclick="saveCategory()">Save</button>
        </div>
    </div>
</div>

<!-- Add/Edit Feed Modal -->
<div class="modal" id="feedModal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="feedModalTitle">Add Feed</h2>
            <button class="modal-close" onclick="closeFeedModal()">
                <span class="material-icons">close</span>
            </button>
        </div>
        <div class="modal-body">
            <form id="feedForm">
                <input type="hidden" id="feedId">
                <div class="form-group">
                    <label for="feedName">Feed Name</label>
                    <input type="text" id="feedName" name="name" required>
                </div>
                <div class="form-group">
                    <label for="feedUrl">Feed URL</label>
                    <input type="url" id="feedUrl" name="url" placeholder="https://example.com/rss" required>
                </div>
                <div class="form-group">
                    <label for="feedCategory">Category</label>
                    <select id="feedCategory" name="category_id" required>
                        <!-- Options populated by JavaScript -->
                    </select>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline" onclick="closeFeedModal()">Cancel</button>
            <button class="btn btn-primary" onclick="saveFeed()">Save</button>
        </div>
    </div>
</div>

<!-- Confirmation Modal -->
<div class="modal" id="confirmModal">
    <div class="modal-content modal-sm">
        <div class="modal-header">
            <h2>Confirm Action</h2>
        </div>
        <div class="modal-body">
            <p id="confirmMessage"></p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline" onclick="closeConfirmModal()">Cancel</button>
            <button class="btn btn-primary btn-danger" id="confirmButton">Delete</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Ensure TokenManager is available (fallback if app.js not loaded yet)
if (typeof TokenManager === 'undefined') {
    window.TokenManager = {
        getToken: () => localStorage.getItem('auth_token') || null,
        setToken: (token) => localStorage.setItem('auth_token', token),
        removeToken: () => localStorage.removeItem('auth_token')
    };
}

// Ensure API_BASE_URL is available
if (typeof API_BASE_URL === 'undefined') {
    window.API_BASE_URL = 'https://tbmcg-news-dashboard.onrender.com';
}
</script>
<script>
let categories = [];
let currentEditingCategory = null;
let currentEditingFeed = null;
let confirmAction = null;

// Helper function for API calls with proper authentication
async function makeAPICall(url, options = {}) {
    const headers = { ...options.headers };
    
    // Add token if available
    const token = TokenManager.getToken();
    if (token) {
        headers['Authorization'] = `Bearer ${token}`;
    }
    
    // Ensure Content-Type is set for POST/PUT requests
    if (options.method && ['POST', 'PUT'].includes(options.method) && !headers['Content-Type']) {
        headers['Content-Type'] = 'application/json';
    }
    
    const response = await fetch(`${API_BASE_URL}${url}`, {
        ...options,
        headers: headers,
        credentials: 'include'  // Include session cookies for backend auth
    });
    
    if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    // Only try to parse JSON if response has content
    const contentType = response.headers.get('content-type');
    if (contentType && contentType.includes('application/json')) {
        return response.json();
    }
    return response.text(); // For responses without JSON content
}

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    loadCategories();
});

// Load categories and feeds
async function loadCategories() {
    toggleLoading(true);
    
    try {
        categories = await makeAPICall('/api/feeds');
        displayCategories();
        populateCategorySelect();
    } catch (error) {
        console.error('Error loading categories:', error);
        showNotification('Failed to load categories', 'error');
        categories = []; // Set empty array to prevent forEach error
    }
    
    toggleLoading(false);
}

// Display categories
function displayCategories() {
    const container = document.getElementById('categoriesContainer');
    
    if (categories.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <span class="material-icons">folder_open</span>
                <h3>No categories yet</h3>
                <p>Create your first category to organize RSS feeds</p>
                <button class="btn btn-primary" onclick="showAddCategoryModal()">
                    <span class="material-icons">create_new_folder</span>
                    Add Category
                </button>
            </div>
        `;
        return;
    }
    
    let html = '';
    categories.forEach(category => {
        const activeFeeds = category.feeds.filter(f => f.enabled).length;
        
        html += `
            <div class="category-card">
                <div class="category-header">
                    <div class="category-info">
                        <span class="material-icons category-icon" style="color: ${category.color}">folder</span>
                        <div>
                            <h3>${category.name}</h3>
                            <p>${category.feeds.length} feeds (${activeFeeds} active)</p>
                        </div>
                    </div>
                    <div class="category-actions">
                        <button class="btn-icon" onclick="editCategory(${category.id})" title="Edit Category">
                            <span class="material-icons">edit</span>
                        </button>
                        <button class="btn-icon btn-danger" onclick="confirmDeleteCategory(${category.id}, '${category.name}')" title="Delete Category">
                            <span class="material-icons">delete</span>
                        </button>
                    </div>
                </div>
                
                <div class="feeds-list">
                    ${category.feeds.length === 0 ? 
                        '<p class="no-feeds">No feeds in this category</p>' :
                        category.feeds.map(feed => `
                            <div class="feed-item ${feed.enabled ? 'enabled' : 'disabled'}">
                                <div class="feed-info">
                                    <span class="material-icons feed-icon">${feed.enabled ? 'rss_feed' : 'rss_feed'}</span>
                                    <div>
                                        <h4>${feed.name}</h4>
                                        <p class="feed-url">${feed.url}</p>
                                    </div>
                                </div>
                                <div class="feed-actions">
                                    <label class="toggle-switch" title="${feed.enabled ? 'Disable' : 'Enable'} feed">
                                        <input type="checkbox" ${feed.enabled ? 'checked' : ''} 
                                               onchange="toggleFeed(${feed.id}, this.checked)">
                                        <span class="toggle-slider"></span>
                                    </label>
                                    <button class="btn-icon" onclick="editFeed(${feed.id}, ${category.id})" title="Edit Feed">
                                        <span class="material-icons">edit</span>
                                    </button>
                                    <button class="btn-icon btn-danger" onclick="confirmDeleteFeed(${feed.id}, '${feed.name}')" title="Delete Feed">
                                        <span class="material-icons">delete</span>
                                    </button>
                                </div>
                            </div>
                        `).join('')
                    }
                </div>
                
                <div class="category-footer">
                    <button class="btn btn-outline btn-sm" onclick="showAddFeedModal(${category.id})">
                        <span class="material-icons">add</span>
                        Add Feed
                    </button>
                </div>
            </div>
        `;
    });
    
    container.innerHTML = html;
}

// Populate category select in feed modal
function populateCategorySelect() {
    const select = document.getElementById('feedCategory');
    select.innerHTML = categories.map(cat => 
        `<option value="${cat.id}" style="color: ${cat.color}">${cat.name}</option>`
    ).join('');
}

// Category Modal Functions
function showAddCategoryModal() {
    currentEditingCategory = null;
    document.getElementById('categoryModalTitle').textContent = 'Add Category';
    document.getElementById('categoryId').value = '';
    document.getElementById('categoryName').value = '';
    document.getElementById('categoryColor').value = '#6366f1';
    initializeColorPicker();
    document.getElementById('categoryModal').style.display = 'flex';
}

function editCategory(categoryId) {
    currentEditingCategory = categoryId;
    const category = categories.find(c => c.id === categoryId);
    
    document.getElementById('categoryModalTitle').textContent = 'Edit Category';
    document.getElementById('categoryId').value = categoryId;
    document.getElementById('categoryName').value = category.name;
    document.getElementById('categoryColor').value = category.color;
    initializeColorPicker(category.color);
    document.getElementById('categoryModal').style.display = 'flex';
}

function closeCategoryModal() {
    document.getElementById('categoryModal').style.display = 'none';
    currentEditingCategory = null;
}

async function saveCategory() {
    const form = document.getElementById('categoryForm');
    const formData = new FormData(form);
    const data = Object.fromEntries(formData);
    
    try {
        const url = currentEditingCategory ? 
            `/api/categories/${currentEditingCategory}` : 
            '/api/categories';
        
        const method = currentEditingCategory ? 'PUT' : 'POST';
        
        await makeAPICall(url, {
            method: method,
            body: JSON.stringify(data)
        });
        
        closeCategoryModal();
        loadCategories();
        showNotification(
            currentEditingCategory ? 'Category updated successfully' : 'Category added successfully', 
            'success'
        );
    } catch (error) {
        console.error('Error saving category:', error);
        showNotification('Failed to save category', 'error');
    }
}

function confirmDeleteCategory(categoryId, categoryName) {
    document.getElementById('confirmMessage').textContent = 
        `Are you sure you want to delete the category "${categoryName}"? This will also delete all feeds in this category.`;
    
    confirmAction = () => deleteCategory(categoryId);
    document.getElementById('confirmModal').style.display = 'flex';
}

async function deleteCategory(categoryId) {
    try {
        await makeAPICall(`/api/categories/${categoryId}`, {
            method: 'DELETE'
        });
        
        closeConfirmModal();
        loadCategories();
        showNotification('Category deleted successfully', 'success');
    } catch (error) {
        console.error('Error deleting category:', error);
        showNotification('Failed to delete category', 'error');
    }
}

// Feed Modal Functions
function showAddFeedModal(categoryId = null) {
    currentEditingFeed = null;
    document.getElementById('feedModalTitle').textContent = 'Add Feed';
    document.getElementById('feedId').value = '';
    document.getElementById('feedName').value = '';
    document.getElementById('feedUrl').value = '';
    
    if (categoryId) {
        document.getElementById('feedCategory').value = categoryId;
    }
    
    document.getElementById('feedModal').style.display = 'flex';
}

function editFeed(feedId, categoryId) {
    currentEditingFeed = feedId;
    const category = categories.find(c => c.id === categoryId);
    const feed = category.feeds.find(f => f.id === feedId);
    
    document.getElementById('feedModalTitle').textContent = 'Edit Feed';
    document.getElementById('feedId').value = feedId;
    document.getElementById('feedName').value = feed.name;
    document.getElementById('feedUrl').value = feed.url;
    document.getElementById('feedCategory').value = categoryId;
    document.getElementById('feedModal').style.display = 'flex';
}

function closeFeedModal() {
    document.getElementById('feedModal').style.display = 'none';
    currentEditingFeed = null;
}

async function saveFeed() {
    const form = document.getElementById('feedForm');
    const formData = new FormData(form);
    const data = Object.fromEntries(formData);
    
    try {
        const url = currentEditingFeed ? 
            `/api/feeds/${currentEditingFeed}` : 
            '/api/feeds';
        
        const method = currentEditingFeed ? 'PUT' : 'POST';
        
        await makeAPICall(url, {
            method: method,
            body: JSON.stringify(data)
        });
        
        closeFeedModal();
        loadCategories();
        showNotification(
            currentEditingFeed ? 'Feed updated successfully' : 'Feed added successfully', 
            'success'
        );
    } catch (error) {
        console.error('Error saving feed:', error);
        showNotification('Failed to save feed', 'error');
    }
}

async function toggleFeed(feedId, enabled) {
    try {
        await makeAPICall(`/api/feeds/${feedId}/toggle`, {
            method: 'POST',
            body: JSON.stringify({ enabled })
        });
        
        loadCategories();
        showNotification(
            enabled ? 'Feed enabled' : 'Feed disabled', 
            'success'
        );
    } catch (error) {
        console.error('Error toggling feed:', error);
        showNotification('Failed to update feed status', 'error');
    }
}

function confirmDeleteFeed(feedId, feedName) {
    document.getElementById('confirmMessage').textContent = 
        `Are you sure you want to delete the feed "${feedName}"?`;
    
    confirmAction = () => deleteFeed(feedId);
    document.getElementById('confirmModal').style.display = 'flex';
}

async function deleteFeed(feedId) {
    try {
        await makeAPICall(`/api/feeds/${feedId}`, {
            method: 'DELETE'
        });
        
        closeConfirmModal();
        loadCategories();
        showNotification('Feed deleted successfully', 'success');
    } catch (error) {
        console.error('Error deleting feed:', error);
        showNotification('Failed to delete feed', 'error');
    }
}

// Confirmation Modal
function closeConfirmModal() {
    document.getElementById('confirmModal').style.display = 'none';
    confirmAction = null;
}

document.getElementById('confirmButton').addEventListener('click', function() {
    if (confirmAction) {
        confirmAction();
    }
});

// Import/Export Functions
function exportFeeds() {
    const data = {
        categories: categories,
        exportDate: new Date().toISOString(),
        version: '1.0'
    };
    
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `tbmcg-feeds-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    showNotification('Feeds exported successfully', 'success');
}

async function importFeeds(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    try {
        const text = await file.text();
        const data = JSON.parse(text);
        
        if (!data.categories || !Array.isArray(data.categories)) {
            throw new Error('Invalid file format');
        }
        
        await makeAPICall('/api/feeds/import', {
            method: 'POST',
            body: JSON.stringify(data)
        });
        
        loadCategories();
        showNotification('Feeds imported successfully', 'success');
    } catch (error) {
        console.error('Error importing feeds:', error);
        showNotification('Failed to import feeds. Please check the file format.', 'error');
    }
    
    // Reset file input
    event.target.value = '';
}

// Color picker functionality
function initializeColorPicker(selectedColor = '#6366f1') {
    const colorPreview = document.getElementById('colorPreview');
    const colorInput = document.getElementById('categoryColor');
    const colorSwatches = document.querySelectorAll('.color-swatch');
    const customColorLabel = document.querySelector('.custom-color-label');
    
    // Set initial color
    colorInput.value = selectedColor;
    colorPreview.style.backgroundColor = selectedColor;
    
    // Update swatch selection
    colorSwatches.forEach(swatch => {
        swatch.classList.remove('selected');
        if (swatch.dataset.color === selectedColor) {
            swatch.classList.add('selected');
        }
    });
    
    // Remove previous event listeners by cloning elements
    const newColorPreview = colorPreview.cloneNode(true);
    colorPreview.parentNode.replaceChild(newColorPreview, colorPreview);
    
    const newCustomColorLabel = customColorLabel.cloneNode(true);
    customColorLabel.parentNode.replaceChild(newCustomColorLabel, customColorLabel);
    
    // Handle swatch clicks
    colorSwatches.forEach(swatch => {
        swatch.removeEventListener('click', swatchClickHandler);
        swatch.addEventListener('click', swatchClickHandler);
    });
    
    // Handle preview click to trigger custom color picker
    newColorPreview.addEventListener('click', function() {
        colorInput.click();
    });
    
    // Handle custom color label click
    newCustomColorLabel.addEventListener('click', function() {
        colorInput.click();
    });
    
    // Handle custom color input changes
    colorInput.removeEventListener('input', colorInputHandler);
    colorInput.addEventListener('input', colorInputHandler);
}

function swatchClickHandler() {
    const color = this.dataset.color;
    selectColor(color);
}

function colorInputHandler() {
    selectColor(this.value);
}

function selectColor(color) {
    const colorPreview = document.getElementById('colorPreview');
    const colorInput = document.getElementById('categoryColor');
    const colorSwatches = document.querySelectorAll('.color-swatch');
    
    // Update input and preview
    colorInput.value = color;
    colorPreview.style.backgroundColor = color;
    
    // Update swatch selection
    colorSwatches.forEach(swatch => {
        swatch.classList.remove('selected');
        if (swatch.dataset.color === color) {
            swatch.classList.add('selected');
        }
    });
}

// Close modals when clicking outside
document.addEventListener('click', function(event) {
    const modals = document.querySelectorAll('.modal');
    modals.forEach(modal => {
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    });
});
</script>

<style>
/* Additional styles for management page */
.manage-container {
    max-width: 1400px;
    margin: 0 auto;
}

.manage-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: var(--spacing-2xl);
    flex-wrap: wrap;
    gap: var(--spacing-lg);
}

.header-actions {
    display: flex;
    gap: var(--spacing-sm);
    flex-wrap: wrap;
}

.categories-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
    gap: var(--spacing-xl);
}

.category-card {
    background: var(--bg-paper);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
    box-shadow: var(--shadow-md);
    border: 1px solid rgba(99, 102, 241, 0.1);
}

.category-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--spacing-lg);
}

.category-info {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
}

.category-icon {
    font-size: 32px;
}

.category-actions {
    display: flex;
    gap: var(--spacing-xs);
}

.feeds-list {
    margin-bottom: var(--spacing-lg);
}

.feed-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-md);
    border: 1px solid var(--gray-200);
    border-radius: var(--radius-sm);
    margin-bottom: var(--spacing-sm);
    transition: var(--transition-hover);
}

.feed-item.disabled {
    opacity: 0.6;
}

.feed-info {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    flex: 1;
    min-width: 0;
}

.feed-icon {
    color: var(--primary-main);
}

.feed-item h4 {
    margin: 0;
    font-size: 1rem;
    font-weight: 600;
}

.feed-url {
    margin: 0;
    font-size: 0.75rem;
    color: var(--gray-500);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.feed-actions {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.btn-icon {
    background: none;
    border: none;
    color: var(--gray-500);
    cursor: pointer;
    padding: var(--spacing-xs);
    border-radius: 50%;
    transition: var(--transition-hover);
}

.btn-icon:hover {
    background: var(--gray-100);
    color: var(--primary-main);
}

.btn-icon.btn-danger:hover {
    background: #fef2f2;
    color: #dc2626;
}

.toggle-switch {
    position: relative;
    display: inline-block;
    width: 48px;
    height: 24px;
    cursor: pointer;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--gray-300);
    border-radius: 24px;
    transition: var(--transition-hover);
}

.toggle-slider:before {
    position: absolute;
    content: "";
    height: 20px;
    width: 20px;
    left: 2px;
    bottom: 2px;
    background: white;
    border-radius: 50%;
    transition: var(--transition-hover);
}

.toggle-switch input:checked + .toggle-slider {
    background: var(--primary-main);
}

.toggle-switch input:checked + .toggle-slider:before {
    transform: translateX(24px);
}

.no-feeds {
    text-align: center;
    color: var(--gray-500);
    font-style: italic;
    padding: var(--spacing-lg);
}

.empty-state {
    text-align: center;
    padding: var(--spacing-2xl);
    color: var(--gray-500);
}

.empty-state .material-icons {
    font-size: 48px;
    margin-bottom: var(--spacing-md);
}

/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    z-index: 2000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(8px);
    align-items: center;
    justify-content: center;
    padding: var(--spacing-lg);
}

.modal-content {
    background: var(--bg-paper);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    width: 100%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    animation: modalSlideIn 0.3s ease-out;
}

.modal-sm .modal-content {
    max-width: 400px;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-lg);
    border-bottom: 1px solid var(--gray-200);
}

.modal-header h2 {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 600;
}

.modal-close {
    background: none;
    border: none;
    color: var(--gray-500);
    cursor: pointer;
    padding: var(--spacing-xs);
    border-radius: 50%;
    transition: var(--transition-hover);
}

.modal-close:hover {
    background: var(--gray-100);
    color: var(--gray-900);
}

.modal-body {
    padding: var(--spacing-lg);
}

.modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: var(--spacing-sm);
    padding: var(--spacing-lg);
    border-top: 1px solid var(--gray-200);
}

.form-group {
    margin-bottom: var(--spacing-lg);
}

.form-group label {
    display: block;
    margin-bottom: var(--spacing-xs);
    font-weight: 600;
    color: var(--gray-700);
}

.form-group input,
.form-group select {
    width: 100%;
    padding: var(--spacing-sm) var(--spacing-md);
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-sm);
    font-family: var(--font-family);
    font-size: 1rem;
    transition: var(--transition-hover);
}

.form-group input:focus,
.form-group select:focus {
    outline: none;
    border-color: var(--primary-main);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

.btn-danger {
    background: #dc2626 !important;
}

.btn-danger:hover {
    background: #b91c1c !important;
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

/* Responsive */
@media (max-width: 900px) {
    .categories-container {
        grid-template-columns: 1fr;
    }
    
    .manage-header {
        flex-direction: column;
        align-items: stretch;
    }
    
    .header-actions {
        justify-content: stretch;
    }
    
    .header-actions .btn {
        flex: 1;
        justify-content: center;
    }
}

@media (max-width: 600px) {
    .feed-item {
        flex-direction: column;
        align-items: stretch;
        gap: var(--spacing-sm);
    }
    
    .feed-actions {
        justify-content: space-between;
    }
}

/* Color Picker Styles */
.color-picker-container {
    display: flex;
    align-items: flex-start;
    gap: var(--spacing-md);
    flex-wrap: wrap;
}

.color-preview {
    width: 50px;
    height: 50px;
    border-radius: var(--radius-md);
    border: 2px solid var(--gray-200);
    background-color: #6366f1;
    transition: var(--transition-hover);
    cursor: pointer;
    position: relative;
    flex-shrink: 0;
}

.color-preview:hover {
    transform: scale(1.05);
    border-color: var(--primary-main);
}

.color-preview::after {
    content: '🎨';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 20px;
    opacity: 0;
    transition: opacity 0.2s ease;
}

.color-preview:hover::after {
    opacity: 0.7;
}

.color-swatches {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
    max-width: 140px;
}

.color-swatch {
    width: 32px;
    height: 32px;
    border-radius: var(--radius-sm);
    border: 2px solid var(--gray-200);
    cursor: pointer;
    transition: var(--transition-hover);
    position: relative;
}

.color-swatch:hover {
    transform: scale(1.1);
    border-color: var(--gray-400);
}

.color-swatch.selected {
    border-color: var(--primary-main);
    transform: scale(1.1);
    box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
}

.color-swatch.selected::after {
    content: '✓';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-weight: bold;
    font-size: 14px;
    text-shadow: 0 0 2px rgba(0,0,0,0.5);
}

.custom-color-input {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
}

.custom-color-label {
    font-size: 0.75rem;
    color: var(--gray-600);
    cursor: pointer;
    padding: 4px 8px;
    border-radius: var(--radius-sm);
    transition: var(--transition-hover);
}

.custom-color-label:hover {
    background: var(--gray-100);
    color: var(--primary-main);
}

@media (max-width: 600px) {
    .color-picker-container {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .color-swatches {
        grid-template-columns: repeat(6, 1fr);
        max-width: 200px;
    }
}
</style>
{% endblock %}